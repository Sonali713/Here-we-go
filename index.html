<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Haselwood Self Check-In</title>
  
  <!-- PWA Meta Tags -->
  <meta name="description" content="Self check-in kiosk for service appointments">
  <meta name="theme-color" content="#00529B">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Check-In">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <style>
    :root {
      --primary: #00529B;
      --bg: #1e293b;
      --card: #fff;
      --muted: #6B7280;
      --err: #DC2626;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }

    .shell {
      width: 100%;
      max-width: 600px;
      background: var(--card);
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.45);
      min-height: 80vh;
    }
    header {
      padding: 18px;
      text-align: center;
      font-weight: 800;
      color: var(--primary);
      border-bottom: 1px solid var(--primary);
    }
    .stack {
      padding: 24px;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .view {
      display: none;
      flex-direction: column;
      gap: 16px;
    }
    .view.active {
      display: flex;
    }

    label {
      display: block;
      font-size: 14px;
      font-weight: 700;
      color: var(--muted);
      margin-bottom: 6px;
      text-transform: uppercase;
    }
    input,
    select {
      width: 100%;
      padding: 14px;
      border-radius: 8px;
      border: 2px solid var(--muted);
      font-size: 16px;
      background: #fff;
      color: #000;
    }
    input:focus,
    select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 6px rgba(0, 82, 155, 0.06);
    }
    .btn {
      background: var(--primary);
      color: #fff;
      padding: 14px;
      border-radius: 12px;
      font-weight: 800;
      border: 0;
      cursor: pointer;
      width: 100%;
    }
    .btn-secondary {
      background: transparent;
      color: var(--primary);
      padding: 14px;
      border-radius: 12px;
      border: 2px solid var(--primary);
      font-weight: 800;
      cursor: pointer;
    }
    .list-group {
      margin: 12px 0;
    }
    .list-group-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      border: 1px solid #eef2f7;
      border-radius: 8px;
      margin: 6px 0;
    }
    #search-error {
      color: var(--err);
      font-size: 14px;
      display: none;
    }

    .signature-row {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
    }
  </style>
</head>
<body>
  <div class="shell" aria-live="polite">
    <header>Haselwood Self Check-In</header>

    <div class="stack">
      <!-- Step 1: Search for Appointment -->
      <div id="view-1" class="view active">
        <h2>Welcome to Self Check-In</h2>
        <p>Search using <strong>Name</strong> or <strong>Phone</strong>.</p>
        <label for="search-name">Name:</label>
        <input id="search-name" type="text" placeholder="e.g., John Doe">
        <label for="search-phone">Phone:</label>
        <input id="search-phone" type="text" placeholder="e.g., 5559876543">
        <button class="btn" onclick="performSearch()">Search</button>
        <p id="search-error">No appointment found. Try again!</p>
      </div>

      <!-- Step 2: Customer Information -->
      <div id="view-2" class="view">
        <h2>Customer Information</h2>
        <label>Name</label>
        <input id="user-name" type="text" readonly>
        <label>Phone</label>
        <input id="user-phone" type="text" readonly>
        <label>Email</label>
        <input id="user-email" type="email">
        <label>Address Line 1</label>
        <input id="address-line-1" type="text">
        <label>Address Line 2</label>
        <input id="address-line-2" type="text">
        <label>City, State, ZIP</label>
        <input id="address-city-state-zip" type="text">
        <label for="preferred-contact">Preferred Contact:</label>
        <select id="preferred-contact">
          <option value="Phone">Phone</option>
          <option value="Email">Email</option>
          <option value="Text">Text</option>
        </select>
        <div style="display: flex; gap: 12px;">
          <button class="btn-secondary" onclick="goBack(1)">Back</button>
          <button class="btn" onclick="saveCustomerInfo()">Next: Vehicle</button>
        </div>
      </div>

      <!-- Step 3: Vehicle Information -->
      <div id="view-3" class="view">
        <h2>Vehicle Information</h2>
        <label>Year</label>
        <input id="vehicle-year" type="text" readonly>
        <label>Make</label>
        <input id="vehicle-make" type="text" readonly>
        <label>Model</label>
        <input id="vehicle-model" type="text" readonly>
        <label>VIN</label>
        <input id="vehicle-vin" type="text" readonly>
        <label>Miles</label>
        <input id="vehicle-miles" type="text" readonly>
        <div style="display: flex; gap: 12px;">
          <button class="btn-secondary" onclick="goBack(2)">Back</button>
          <button class="btn" onclick="goTo(4)">Next: Services</button>
        </div>
      </div>

      <!-- Step 4: Services -->
      <div id="view-4" class="view">
        <h2>Services</h2>
        <h3>Primary Services</h3>
        <ul id="primary-service" class="list-group"></ul>
        <h3>Additional Common Services</h3>
        <ul id="common-services" class="list-group"></ul>
        <div style="display: flex; gap: 12px;">
          <button class="btn-secondary" onclick="goBack(3)">Back</button>
          <button class="btn" onclick="finalizeCheckIn()">Complete</button>
        </div>
      </div>

      <!-- Step 5: Confirmation -->
      <div id="view-5" class="view">
        <h2>Check-In Complete</h2>
        <p><strong>Thank you for completing your check-in. Please give your keys to a service advisor.</strong></p>
        <ul id="service-summary" class="list-group"></ul>
        <p><strong>Subtotal: $<span id="subtotal-price">0.00</span></strong></p>
        <p>
          <em>* Subtotal does not include sales tax or shop supplies.</em><br>
          <em>* A 3% surcharge applies to credit card payments.</em>
        </p>
        <div class="signature-row">
          <label>Signature:</label>
          <input type="text" id="signature" placeholder="Sign here..." />
        </div>
        <button class="btn" onclick="reloadPage()">Back to Check-In</button>
      </div>
    </div>
  </div>

  <script>
    const appointments = [
      {
        phone: "5559876543",
        name: "John Doe",
        email: "johndoe@example.com",
        addressLine1: "123 Elm Street",
        addressLine2: "Apt 456",
        cityStateZip: "Bremerton, WA, 98310",
        preferredContact: "Phone",
        year: "2020",
        make: "Toyota",
        model: "Camry",
        vin: "JT4AC1234567890",
        miles: "20,500",
        primaryServices: [{ name: "Oil Change", price: 39.99 }],
        commonServices: [
          { name: "Tire Rotation", price: 19.99 },
          { name: "Brake Inspection", price: 24.99 },
          { name: "Battery Check", price: 14.99 }
        ]
      }
    ];

    let selectedAppointment = null;
    let selectedServices = [];

    function performSearch() {
      const name = document.getElementById("search-name").value.trim().toLowerCase();
      const phone = document.getElementById("search-phone").value.trim();

      selectedAppointment = appointments.find(
        appt => appt.name.toLowerCase() === name || appt.phone === phone
      );

      if (!selectedAppointment) {
        document.getElementById("search-error").style.display = "block";
      } else {
        document.getElementById("search-error").style.display = "none";
        populateCustomerInfo();
        goTo(2);
      }
    }

    function populateCustomerInfo() {
      document.getElementById("user-name").value = selectedAppointment.name;
      document.getElementById("user-phone").value = selectedAppointment.phone;
      document.getElementById("user-email").value = selectedAppointment.email;
      document.getElementById("address-line-1").value = selectedAppointment.addressLine1;
      document.getElementById("address-line-2").value = selectedAppointment.addressLine2;
      document.getElementById("address-city-state-zip").value = selectedAppointment.cityStateZip;
      document.getElementById("preferred-contact").value = selectedAppointment.preferredContact;
    }

    function saveCustomerInfo() {
      populateVehicleInfo();
      goTo(3);
    }

    function populateVehicleInfo() {
      document.getElementById("vehicle-year").value = selectedAppointment.year;
      document.getElementById("vehicle-make").value = selectedAppointment.make;
      document.getElementById("vehicle-model").value = selectedAppointment.model;
      document.getElementById("vehicle-vin").value = selectedAppointment.vin;
      document.getElementById("vehicle-miles").value = selectedAppointment.miles;
    }

    function populateServices() {
      const primaryServicesElement = document.getElementById("primary-service");
      const commonServicesElement = document.getElementById("common-services");

      primaryServicesElement.innerHTML = selectedAppointment.primaryServices
        .map(
          service =>
            `<li class="list-group-item">
              <span>${service.name}</span>
              <span>$${service.price.toFixed(2)}</span>
            </li>`
        )
        .join("");

      commonServicesElement.innerHTML = selectedAppointment.commonServices
        .map(
          service =>
            `<li class="list-group-item">
              <label>
                <input type="checkbox" onchange="toggleService('${service.name}', ${service.price})">
                ${service.name}
              </label>
              <span>$${service.price.toFixed(2)}</span>
            </li>`
        )
        .join("");
    }

    function toggleService(name, price) {
      const index = selectedServices.findIndex(service => service.name === name);
      if (index >= 0) {
        selectedServices.splice(index, 1); // Remove service
      } else {
        selectedServices.push({ name, price }); // Add service
      }
    }

    function finalizeCheckIn() {
      const allServices = [...selectedAppointment.primaryServices, ...selectedServices];
      const serviceSummary = document.getElementById("service-summary");
      let subtotal = 0;

      serviceSummary.innerHTML = allServices
        .map(service => {
          subtotal += service.price;
          return `<li class="list-group-item">
                    <span>${service.name}</span>
                    <span>$${service.price.toFixed(2)}</span>
                  </li>`;
        })
        .join("");

      document.getElementById("subtotal-price").innerText = subtotal.toFixed(2);
      goTo(5);
    }

    function reloadPage() {
      location.reload();
    }

    function goTo(view) {
      document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
      document.getElementById(`view-${view}`).classList.add("active");

      if (view === 4) populateServices();
    }

    function goBack(view) {
      goTo(view);
    }

    // Register Service Worker for PWA functionality
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(registration => {
            console.log('Service Worker registered successfully:', registration.scope);
          })
          .catch(error => {
            console.log('Service Worker registration failed:', error);
          });
      });
    }
  </script>
</body>
</html>